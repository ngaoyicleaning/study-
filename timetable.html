<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Exam Countdown Study Timetable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .countdown-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin: 10px 0;
        }
        .countdown-number {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 5px 0;
        }
        .countdown-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        .exam-day {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%) !important;
            color: white !important;
            font-weight: 600;
        }
        .tutoring-session {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%) !important;
            color: white !important;
        }
        .past-paper {
            background: linear-gradient(135deg, #45b7d1 0%, #96c93d 100%) !important;
            color: white !important;
        }
        .subject-math { background-color: #fef3c7; border-left: 4px solid #f59e0b; }
        .subject-english { background-color: #fce7f3; border-left: 4px solid #ec4899; }
        .subject-life-science { background-color: #dcfce7; border-left: 4px solid #16a34a; }
        .subject-geography { background-color: #dbeafe; border-left: 4px solid #3b82f6; }
        .subject-history { background-color: #f3e8ff; border-left: 4px solid #8b5cf6; }
        .subject-business { background-color: #ffedd5; border-left: 4px solid #ea580c; }
        .subject-isizulu { background-color: #ecfdf5; border-left: 4px solid #10b981; }
        .individual-countdown {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 8px;
            margin-top: 5px;
        }
        .individual-countdown .time-unit {
            display: inline-block;
            margin: 0 2px;
            min-width: 30px;
        }
        .individual-countdown .number {
            font-size: 0.9rem;
            font-weight: bold;
        }
        .individual-countdown .label {
            font-size: 0.6rem;
            opacity: 0.8;
        }
        .today-highlight {
            border: 2px solid #f59e0b;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
        }
        .urgent-countdown {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header with Countdown -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900 mb-4">Live Exam Countdown Study Timetable</h1>
            <div id="current-time" class="text-lg text-slate-600 mb-2 font-medium"></div>
            <p class="text-lg text-slate-600 mb-6">Study Period: <span id="study-period"></span> | Study until 23:00 daily</p>
            
            <div id="next-exam-countdown" class="countdown-box max-w-2xl mx-auto">
                <div class="text-lg font-semibold mb-2" id="next-exam-title">Loading next exam...</div>
                <div class="flex justify-center space-x-4" id="countdown-timer">
                    <div class="text-center">
                        <div class="countdown-number" id="days">0</div>
                        <div class="countdown-label">Days</div>
                    </div>
                    <div class="text-center">
                        <div class="countdown-number" id="hours">0</div>
                        <div class="countdown-label">Hours</div>
                    </div>
                    <div class="text-center">
                        <div class="countdown-number" id="minutes">0</div>
                        <div class="countdown-label">Minutes</div>
                    </div>
                    <div class="text-center">
                        <div class="countdown-number" id="seconds">0</div>
                        <div class="countdown-label">Seconds</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Today's Focus -->
        <div id="today-focus" class="bg-amber-50 border-l-4 border-amber-500 p-4 mb-6 rounded-lg hidden">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <span class="text-amber-500 text-lg">ðŸ“š</span>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-amber-800" id="today-title">TODAY'S FOCUS</h3>
                    <div class="mt-1 text-sm text-amber-700" id="today-schedule">
                        <!-- Today's schedule will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Exam Schedule Overview with Individual Countdowns -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-slate-900 mb-6">Exam Schedule with Live Countdowns</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="exam-schedule">
                <!-- Exam dates will be inserted here with individual countdowns -->
            </div>
        </div>

        <!-- Study Timetable -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-slate-100 border-b border-slate-200">
                        <tr>
                            <th scope="col" class="px-6 py-4 font-semibold text-slate-900">Date</th>
                            <th scope="col" class="px-6 py-4 font-semibold text-slate-900">Time</th>
                            <th scope="col" class="px-6 py-4 font-semibold text-slate-900">Subject</th>
                            <th scope="col" class="px-6 py-4 font-semibold text-slate-900">Focus / Description</th>
                        </tr>
                    </thead>
                    <tbody id="timetable-body" class="divide-y divide-slate-200">
                        <!-- Rows will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Study Strategy -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="p-6">
                <h2 class="text-xl font-bold text-slate-900 mb-4">Study Strategy & Focus Areas</h2>
                <div class="space-y-6">
                    <div>
                        <h3 class="font-semibold text-lg text-red-700 mb-2">High Priority Focus (Mathematics & Life Sciences)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="border-l-4 border-red-500 pl-4">
                                <h4 class="font-medium text-slate-900">Mathematics (41% â†’ 74%)</h4>
                                <ul class="text-sm text-slate-600 mt-1 list-disc list-inside">
                                    <li>Daily practice of core concepts (2+ hours)</li>
                                    <li>Focus on algebra, functions, and trigonometry</li>
                                    <li>Complete 3+ past papers weekly</li>
                                    <li>Target weak areas identified in previous exams</li>
                                </ul>
                            </div>
                            <div class="border-l-4 border-red-500 pl-4">
                                <h4 class="font-medium text-slate-900">Life Sciences (60% â†’ 82%)</h4>
                                <ul class="text-sm text-slate-600 mt-1 list-disc list-inside">
                                    <li>Daily diagram practice and terminology</li>
                                    <li>Focus on human physiology and genetics</li>
                                    <li>Create detailed study notes for each topic</li>
                                    <li>Practice data interpretation questions</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Medium Priority -->
                    <div>
                        <h3 class="font-semibold text-lg text-amber-700 mb-2">Medium Priority Focus (Geography & History)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="border-l-4 border-amber-500 pl-4">
                                <h4 class="font-medium text-slate-900">Geography (67% â†’ 83%)</h4>
                                <ul class="text-sm text-slate-600 mt-1 list-disc list-inside">
                                    <li>Mapwork practice twice weekly</li>
                                    <li>Case study memorization techniques</li>
                                    <li>Focus on climate and geomorphology</li>
                                    <li>Practice data response questions</li>
                                </ul>
                            </div>
                            <div class="border-l-4 border-amber-500 pl-4">
                                <h4 class="font-medium text-slate-900">History (80% â†’ 91%)</h4>
                                <ul class="text-sm text-slate-600 mt-1 list-disc list-inside">
                                    <li>Essay structure perfection</li>
                                    <li>Source-based question practice</li>
                                    <li>Timeline creation for key events</li>
                                    <li>Focus on Cold War and globalization</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center mt-8 text-sm text-slate-500">
            <p>Stay consistent and track your progress weekly. You can achieve these goals!</p>
        </footer>
    </div>

    <script>
        // Get current device date and time
        let currentDate = new Date();
        
        // Exam dates for current year (will auto-adjust based on current year)
        const getExamDates = () => {
            const currentYear = currentDate.getFullYear();
            return [
                { date: `${currentYear}-10-17`, subject: 'English Paper 3 (Creative Writing)', priority: 'high' },
                { date: `${currentYear}-10-21`, subject: 'English Paper 2 (Literature)', priority: 'high' },
                { date: `${currentYear}-10-24`, subject: 'Mathematics Paper 1', priority: 'high' },
                { date: `${currentYear}-10-27`, subject: 'FAL Paper 3 + Mathematics Paper 2', priority: 'high' },
                { date: `${currentYear}-11-04`, subject: 'IsiZulu Paper 1 + Business Studies Paper 1', priority: 'medium' },
                { date: `${currentYear}-11-06`, subject: 'IsiZulu FAL Paper 2 + English HL Paper 1', priority: 'medium' },
                { date: `${currentYear}-11-07`, subject: 'Geography Paper 1', priority: 'medium' },
                { date: `${currentYear}-11-10`, subject: 'Business Studies Paper 2', priority: 'medium' },
                { date: `${currentYear}-11-12`, subject: 'History Paper 1', priority: 'medium' },
                { date: `${currentYear}-11-14`, subject: 'Life Sciences Paper 1', priority: 'high' },
                { date: `${currentYear}-11-17`, subject: 'Life Sciences Paper 2', priority: 'high' },
                { date: `${currentYear}-11-19`, subject: 'Geography Paper 2', priority: 'medium' },
                { date: `${currentYear}-11-21`, subject: 'History Paper 2', priority: 'medium' }
            ];
        };

        let examDates = getExamDates();

        // Generate study schedule for current year
        const getStudyPeriod = () => {
            const currentYear = currentDate.getFullYear();
            const startDate = new Date(`${currentYear}-10-02`);
            const endDate = new Date(`${currentYear}-11-21`);
            
            // If we're past November 21, use next year's dates
            if (currentDate > endDate) {
                const nextYear = currentYear + 1;
                examDates = [
                    { date: `${nextYear}-10-17`, subject: 'English Paper 3 (Creative Writing)', priority: 'high' },
                    { date: `${nextYear}-10-21`, subject: 'English Paper 2 (Literature)', priority: 'high' },
                    { date: `${nextYear}-10-24`, subject: 'Mathematics Paper 1', priority: 'high' },
                    { date: `${nextYear}-10-27`, subject: 'FAL Paper 3 + Mathematics Paper 2', priority: 'high' },
                    { date: `${nextYear}-11-04`, subject: 'IsiZulu Paper 1 + Business Studies Paper 1', priority: 'medium' },
                    { date: `${nextYear}-11-06`, subject: 'IsiZulu FAL Paper 2 + English HL Paper 1', priority: 'medium' },
                    { date: `${nextYear}-11-07`, subject: 'Geography Paper 1', priority: 'medium' },
                    { date: `${nextYear}-11-10`, subject: 'Business Studies Paper 2', priority: 'medium' },
                    { date: `${nextYear}-11-12`, subject: 'History Paper 1', priority: 'medium' },
                    { date: `${nextYear}-11-14`, subject: 'Life Sciences Paper 1', priority: 'high' },
                    { date: `${nextYear}-11-17`, subject: 'Life Sciences Paper 2', priority: 'high' },
                    { date: `${nextYear}-11-19`, subject: 'Geography Paper 2', priority: 'medium' },
                    { date: `${nextYear}-11-21`, subject: 'History Paper 2', priority: 'medium' }
                ];
                return { startDate: new Date(`${nextYear}-10-02`), endDate: new Date(`${nextYear}-11-21`) };
            }
            
            // If we're before October 2, use current year
            if (currentDate < startDate) {
                return { startDate, endDate };
            }
            
            // We're in the study period
            return { startDate: currentDate, endDate };
        };

        const { startDate, endDate } = getStudyPeriod();
        const studySchedule = [];
        
        // Define session times
        const sessionTimes = [
            { start: '06:00', end: '07:30' },
            { start: '08:00', end: '10:00' },
            { start: '10:30', end: '12:30' },
            { start: '14:00', end: '15:00' }, // Before tutoring
            { start: '15:00', end: '17:00', tutoring: true },
            { start: '19:00', end: '21:00' },
            { start: '21:30', end: '23:00' }
        ];
        
        // Define subject patterns for each day of the week
        const weeklyPattern = {
            0: { // Sunday - Past Papers
                subjects: [
                    'Past Paper: Mathematics',
                    'Past Paper: Life Sciences',
                    'Past Paper: Geography',
                    'Past Paper: History',
                    'Tutoring Session',
                    'Past Paper: English',
                    'Past Paper: Business/IsiZulu'
                ],
                priorities: ['pastpaper', 'pastpaper', 'pastpaper', 'pastpaper', 'tutoring', 'pastpaper', 'pastpaper'],
                descriptions: [
                    'Timed practice under exam conditions',
                    'Timed practice under exam conditions',
                    'Timed practice under exam conditions',
                    'Timed practice under exam conditions',
                    'Exam strategy and weak areas',
                    'Timed practice under exam conditions',
                    'Timed practice under exam conditions'
                ]
            },
            1: { // Monday
                subjects: ['Mathematics', 'Life Sciences', 'Geography', 'English', 'Tutoring: Mathematics', 'History', 'Review & Planning'],
                priorities: ['high', 'high', 'medium', 'low', 'tutoring', 'medium', 'review'],
                descriptions: [
                    'Core concepts & problem solving',
                    'Terminology & diagrams',
                    'Mapwork & case studies',
                    'Vocabulary & reading',
                    'Focus on weak areas',
                    'Essay writing practice',
                    'Weekly goals & progress tracking'
                ]
            },
            2: { // Tuesday
                subjects: ['Life Sciences', 'Mathematics', 'History', 'Business Studies', 'Tutoring: Life Sciences', 'IsiZulu', 'Mathematics'],
                priorities: ['high', 'high', 'medium', 'low', 'tutoring', 'low', 'high'],
                descriptions: [
                    'Human body systems',
                    'Algebra & functions',
                    'Essay structures',
                    'Case studies',
                    'Diagrams & processes',
                    'Comprehension & writing',
                    'Weak area focus'
                ]
            },
            3: { // Wednesday
                subjects: ['Mathematics', 'Life Sciences', 'Geography', 'English', 'Tutoring: Mathematics', 'History', 'Life Sciences'],
                priorities: ['high', 'high', 'medium', 'low', 'tutoring', 'medium', 'high'],
                descriptions: [
                    'Trigonometry & geometry',
                    'Genetics & evolution',
                    'Climate & geomorphology',
                    'Timed essay practice',
                    'Problem areas',
                    'Source-based questions',
                    'Diagrams & processes'
                ]
            },
            4: { // Thursday
                subjects: ['Life Sciences', 'Mathematics', 'History', 'Business Studies', 'Tutoring: Exam Strategy', 'IsiZulu', 'Mathematics'],
                priorities: ['high', 'high', 'medium', 'low', 'tutoring', 'low', 'high'],
                descriptions: [
                    'Plant & animal physiology',
                    'Past paper full test',
                    'Timeline & events',
                    'Terminology & concepts',
                    'Time management techniques',
                    'Grammar & vocabulary',
                    'Problem areas revision'
                ]
            },
            5: { // Friday
                subjects: ['Mathematics', 'Life Sciences', 'Geography', 'English', 'Tutoring: Problem Areas', 'All Subjects', 'Planning'],
                priorities: ['high', 'high', 'medium', 'low', 'tutoring', 'review', 'review'],
                descriptions: [
                    'Mixed topic practice',
                    'Past paper questions',
                    'Data response practice',
                    'Literature analysis',
                    'Targeted support',
                    'Weekly review & testing',
                    'Next week strategy'
                ]
            },
            6: { // Saturday
                subjects: ['Mathematics', 'Life Sciences', 'Geography', 'History', 'Tutoring: Exam Techniques', 'Weak Areas', 'Rest & Recovery'],
                priorities: ['high', 'high', 'medium', 'medium', 'tutoring', 'high', 'review'],
                descriptions: [
                    'Timed Paper 1 practice',
                    'Timed Paper 1 practice',
                    'Timed Paper 1 practice',
                    'Timed Paper 1 practice',
                    'Answering techniques',
                    'Targeted practice',
                    'Important for retention'
                ]
            }
        };

        // Function to get color based on priority/subject
        function getColorForSubject(subject) {
            const s = subject.toLowerCase();
            if (s.includes('tutoring')) return 'tutoring-session';
            if (s.includes('past paper')) return 'past-paper';
            if (s.includes('math')) return 'subject-math';
            if (s.includes('english')) return 'subject-english';
            if (s.includes('life science')) return 'subject-life-science';
            if (s.includes('geography')) return 'subject-geography';
            if (s.includes('history')) return 'subject-history';
            if (s.includes('business')) return 'subject-business';
            if (s.includes('isizulu')) return 'subject-isizulu';
            if (s.includes('review') || s.includes('planning') || s.includes('rest')) return 'bg-gray-100';
            return 'bg-gray-100';
        }

        // Function to format date string
        function formatDate(date) {
            return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }

        // Function to format time string
        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }

        // Function to check if date is today
        function isToday(date) {
            const today = new Date(currentDate);
            return date.getDate() === today.getDate() && 
                   date.getMonth() === today.getMonth() && 
                   date.getFullYear() === today.getFullYear();
        }

        // Function to calculate time until exam
        function getTimeUntilExam(examDate) {
            const now = new Date();
            const exam = new Date(examDate);
            const timeDiff = exam - now;
            
            if (timeDiff <= 0) return { days: 0, hours: 0, minutes: 0, seconds: 0, passed: true };
            
            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
            
            return { days, hours, minutes, seconds, passed: false };
        }

        // Update current time display
        function updateCurrentTime() {
            const now = new Date();
            currentDate = now;
            document.getElementById('current-time').textContent = `Current Time: ${formatDate(now)} - ${formatTime(now)}`;
        }

        // Update study period display
        function updateStudyPeriod() {
            document.getElementById('study-period').textContent = `${formatDate(startDate)} â€“ ${formatDate(endDate)}`;
        }

        // Update today's focus
        function updateTodaysFocus() {
            const todayFocus = document.getElementById('today-focus');
            const todaySchedule = document.getElementById('today-schedule');
            
            if (isToday(startDate)) {
                const currentHour = currentDate.getHours();
                const currentMinute = currentDate.getMinutes();
                const currentTime = currentHour * 60 + currentMinute;
                
                let focusText = '';
                
                // Determine current and upcoming sessions based on actual time
                if (currentTime < 14 * 60) { // Before 14:00
                    focusText = `
                        <p><strong>Current Time: ${formatTime(currentDate)}</strong> - Focus on morning study sessions</p>
                        <p><strong>14:00-15:00:</strong> Afternoon study session</p>
                        <p><strong>15:00-17:00:</strong> First tutoring session - Mathematics focus</p>
                        <p><strong>Evening:</strong> Continue with scheduled study plan</p>
                    `;
                } else if (currentTime < 15 * 60) { // 14:00-15:00
                    focusText = `
                        <p><strong>Current Time: ${formatTime(currentDate)}</strong> - Afternoon study session in progress</p>
                        <p><strong>15:00-17:00:</strong> Upcoming: Tutoring session - Mathematics focus</p>
                        <p><strong>Evening:</strong> Continue with scheduled study plan</p>
                    `;
                } else if (currentTime < 17 * 60) { // 15:00-17:00
                    focusText = `
                        <p><strong>Current Time: ${formatTime(currentDate)}</strong> - Tutoring session in progress</p>
                        <p><strong>17:00-19:00:</strong> Break and physical activity</p>
                        <p><strong>19:00-23:00:</strong> Evening study sessions</p>
                    `;
                } else { // After 17:00
                    focusText = `
                        <p><strong>Current Time: ${formatTime(currentDate)}</strong> - Continue with evening study sessions</p>
                        <p><strong>Focus:</strong> Complete today's scheduled topics</p>
                        <p><strong>End:</strong> Finish by 23:00 as planned</p>
                    `;
                }
                
                todaySchedule.innerHTML = focusText;
                todayFocus.classList.remove('hidden');
            } else {
                todayFocus.classList.add('hidden');
            }
        }

        // Countdown timer function
        function updateCountdown() {
            const now = new Date();
            let nextExam = null;
            let timeDiff = Infinity;
            
            // Find the next upcoming exam
            examDates.forEach(exam => {
                const examDate = new Date(exam.date);
                if (examDate > now) {
                    const diff = examDate - now;
                    if (diff < timeDiff) {
                        timeDiff = diff;
                        nextExam = exam;
                    }
                }
            });
            
            if (nextExam) {
                const examDate = new Date(nextExam.date);
                const totalSeconds = Math.floor((examDate - now) / 1000);
                
                const days = Math.floor(totalSeconds / (3600 * 24));
                const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = Math.floor(totalSeconds % 60);
                
                document.getElementById('next-exam-title').textContent = `Next: ${nextExam.subject}`;
                document.getElementById('days').textContent = days;
                document.getElementById('hours').textContent = hours;
                document.getElementById('minutes').textContent = minutes;
                document.getElementById('seconds').textContent = seconds;
                
                // Add urgent animation if less than 24 hours
                const countdownTimer = document.getElementById('countdown-timer');
                if (days === 0 && hours < 24) {
                    countdownTimer.classList.add('urgent-countdown');
                } else {
                    countdownTimer.classList.remove('urgent-countdown');
                }
            } else {
                document.getElementById('next-exam-title').textContent = 'All exams completed!';
                document.getElementById('countdown-timer').style.display = 'none';
            }
            
            // Update individual exam countdowns
            updateIndividualCountdowns();
        }

        // Update individual exam countdowns
        function updateIndividualCountdowns() {
            const examElements = document.querySelectorAll('.exam-item');
            examElements.forEach(element => {
                const examDate = element.getAttribute('data-exam-date');
                const countdownElement = element.querySelector('.individual-countdown');
                
                if (countdownElement) {
                    const timeUntil = getTimeUntilExam(examDate);
                    
                    if (timeUntil.passed) {
                        countdownElement.innerHTML = '<div class="text-xs">Exam Completed</div>';
                        countdownElement.classList.remove('urgent-countdown');
                    } else {
                        countdownElement.innerHTML = `
                            <div class="time-unit">
                                <div class="number">${timeUntil.days}</div>
                                <div class="label">d</div>
                            </div>
                            <div class="time-unit">
                                <div class="number">${timeUntil.hours}</div>
                                <div class="label">h</div>
                            </div>
                            <div class="time-unit">
                                <div class="number">${timeUntil.minutes}</div>
                                <div class="label">m</div>
                            </div>
                            <div class="time-unit">
                                <div class="number">${timeUntil.seconds}</div>
                                <div class="label">s</div>
                            </div>
                        `;
                        
                        // Add urgent styling for exams within 24 hours
                        if (timeUntil.days === 0 && timeUntil.hours < 24) {
                            countdownElement.classList.add('urgent-countdown');
                        } else {
                            countdownElement.classList.remove('urgent-countdown');
                        }
                    }
                }
            });
        }

        // Render exam schedule with individual countdowns
        function renderExamSchedule() {
            const examScheduleEl = document.getElementById('exam-schedule');
            examScheduleEl.innerHTML = '';
            
            examDates.forEach(exam => {
                const examDate = new Date(exam.date);
                const isUpcoming = examDate > currentDate;
                const timeUntil = getTimeUntilExam(exam.date);
                
                const examEl = document.createElement('div');
                examEl.className = `exam-item p-4 rounded-lg border-l-4 ${
                    exam.priority === 'high' ? 'bg-red-50 border-red-500' : 'bg-blue-50 border-blue-500'
                } ${!isUpcoming ? 'opacity-60' : ''}`;
                examEl.setAttribute('data-exam-date', exam.date);
                
                let countdownHtml = '';
                if (timeUntil.passed) {
                    countdownHtml = '<div class="individual-countdown"><div class="text-xs">Exam Completed</div></div>';
                } else {
                    countdownHtml = `
                        <div class="individual-countdown">
                            <div class="time-unit">
                                <div class="number">${timeUntil.days}</div>
                                <div class="label">d</div>
                            </div>
                            <div class="time-unit">
                                <div class="number">${timeUntil.hours}</div>
                                <div class="label">h</div>
                            </div>
                            <div class="time-unit">
                                <div class="number">${timeUntil.minutes}</div>
                                <div class="label">m</div>
                            </div>
                            <div class="time-unit">
                                <div class="number">${timeUntil.seconds}</div>
                                <div class="label">s</div>
                            </div>
                        </div>
                    `;
                }
                
                examEl.innerHTML = `
                    <h3 class="font-semibold ${exam.priority === 'high' ? 'text-red-800' : 'text-blue-800'}">
                        ${formatDate(examDate)}
                    </h3>
                    <p class="${exam.priority === 'high' ? 'text-red-700' : 'text-blue-700'} text-sm mt-1">
                        ${exam.subject}
                    </p>
                    ${countdownHtml}
                    ${!isUpcoming ? '<p class="text-xs text-gray-500 mt-1">Completed</p>' : ''}
                `;
                
                examScheduleEl.appendChild(examEl);
            });
        }

        // Generate the study schedule
        function generateStudySchedule() {
            studySchedule.length = 0; // Clear previous schedule
            let scheduleDate = new Date(startDate);
            while (scheduleDate <= endDate) {
                const dayOfWeek = scheduleDate.getDay();
                const dayPattern = weeklyPattern[dayOfWeek];
                const isExamDay = examDates.some(exam => exam.date === scheduleDate.toISOString().split('T')[0]);
                
                // On exam days, only have light revision in the morning
                if (isExamDay) {
                    studySchedule.push({
                        date: new Date(scheduleDate),
                        time: '06:00 - 07:00',
                        subject: 'Light Revision Only',
                        description: 'Quick review of key formulas/concepts - no new learning',
                        isExamDay: true,
                        isToday: isToday(scheduleDate)
                    });
                    studySchedule.push({
                        date: new Date(scheduleDate),
                        time: '07:00 - 08:00',
                        subject: 'Exam Preparation',
                        description: 'Mental preparation, pack bags, travel to exam venue',
                        isExamDay: true,
                        isToday: isToday(scheduleDate)
                    });
                    studySchedule.push({
                        date: new Date(scheduleDate),
                        time: 'After Exam',
                        subject: 'Rest & Recovery',
                        description: 'Important mental break after exam',
                        isExamDay: true,
                        isToday: isToday(scheduleDate)
                    });
                } else {
                    for (let i = 0; i < sessionTimes.length; i++) {
                        studySchedule.push({
                            date: new Date(scheduleDate),
                            time: `${sessionTimes[i].start} - ${sessionTimes[i].end}`,
                            subject: dayPattern.subjects[i],
                            description: dayPattern.descriptions[i],
                            isTutoring: sessionTimes[i].tutoring || false,
                            isToday: isToday(scheduleDate)
                        });
                    }
                }
                
                // Move to next day
                scheduleDate.setDate(scheduleDate.getDate() + 1);
            }
        }

        // Render the timetable
        function renderTimetable() {
            const tableBody = document.getElementById('timetable-body');
            tableBody.innerHTML = '';
            let lastDate = '';
            
            studySchedule.forEach(session => {
                const displayDate = formatDate(session.date);
                let dateCellContent = '';
                
                // Show date only when it changes to group events by day
                if (displayDate !== lastDate) {
                    dateCellContent = `<div class="font-semibold text-slate-900 ${session.isToday ? 'today-highlight p-2 rounded bg-amber-50' : ''}">${displayDate}${session.isToday ? ' (TODAY)' : ''}</div>`;
                    lastDate = displayDate;
                }
                
                const colorClasses = getColorForSubject(session.subject);
                const isExamDay = session.isExamDay;
                
                const tr = document.createElement('tr');
                tr.className = `hover:bg-slate-50 ${session.isToday ? 'today-highlight' : ''}`;
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${dateCellContent}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${session.time}</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${colorClasses} ${isExamDay ? 'exam-day' : ''}">
                            ${session.subject}
                        </span>
                    </td>
                    <td class="px-6 py-4">${session.description}</td>
                `;
                tableBody.appendChild(tr);
            });
        }

        // Main update function that runs every second
        function updateAll() {
            updateCurrentTime();
            updateStudyPeriod();
            updateTodaysFocus();
            updateCountdown();
        }

        // Initialize everything
        function init() {
            updateAll();
            renderExamSchedule();
            generateStudySchedule();
            renderTimetable();
            
            // Update everything every second for live countdowns
            setInterval(updateAll, 1000);
            
            // Update schedule display every minute (in case dates change)
            setInterval(() => {
                renderExamSchedule();
                generateStudySchedule();
                renderTimetable();
            }, 60000);
        }

        // Start the application
        init();
    </script>
</body>
</html>
